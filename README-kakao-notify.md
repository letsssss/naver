# 이지티켓 카카오 알림 기능 가이드

이 문서는 이지티켓 플랫폼에서 메시지 알림 기능 설정 및 사용 방법을 안내합니다.

## 기능 개요

사용자가 채팅 메시지를 보내면 수신자에게 카카오톡 알림을 자동으로 전송하는 기능입니다.

## 필요한 환경 변수

`.env.local` 파일에 다음 환경 변수를 추가해야 합니다:

```
# Solapi 카카오 알림 설정
SOLAPI_API_KEY=your_api_key_here
SOLAPI_API_SECRET=your_api_secret_here
SOLAPI_SENDER_KEY=KA01PF2504270350090645hp8rQ1lvqL
SOLAPI_TEMPLATE_CODE=KA01TP230126085130773ZHcIHN4i674
SENDER_PHONE=01056183450  # 발신 번호 (하이픈 없이)
```

현재 설정된 기본값:

| 항목 | 값 |
|------|-----|
| 템플릿 코드 | `KA01TP230126085130773ZHcIHN4i674` |
| 발신 프로필 키 (senderKey) | `KA01PF2504270350090645hp8rQ1lvqL` |
| 발신번호 (sender) | `010-5618-3450` |

## 템플릿 내용

현재 구현된 알림톡 메시지 형식:
```
${이름}님, 이지티켓에 새로운 메시지가 도착했습니다. 확인해보세요!
```

> **중요**: 실제 발송 시 승인된 템플릿 형식과 정확히 일치해야 합니다. 템플릿 형식이 다른 경우 API 코드를 수정해야 합니다.

## 테스트 방법

1. Solapi 계정 설정 확인
   - [Solapi 대시보드](https://message.solapi.com/)에서 로그인합니다.
   - 비즈니스 채널과 템플릿이 활성화되었는지 확인합니다.
   - API 키와 시크릿이 유효한지 확인합니다.

2. 개발 환경에서 테스트
   - API 키와 시크릿을 `.env.local` 파일에 추가합니다.
   - 개발 서버를 실행합니다.
   - 채팅방에서 메시지를 전송하고 알림이 제대로 발송되는지 확인합니다.
   - 브라우저 콘솔에서 로그를 확인하여 알림 발송 과정을 모니터링합니다.

## 주의사항

- 카카오 알림톡은 승인된 템플릿 형식에 맞춰야 발송됩니다.
- 템플릿 변수(#{변수명})는 정확한 위치에 적용되어야 합니다.
- 테스트 시에는 실제 사용자 번호를 사용하지 않도록 주의하세요.
- 발신 번호는 Solapi에 등록된 번호여야 합니다.
- 알림톡 실패 시 SMS로 대체 발송될 수 있으며, 추가 비용이 발생할 수 있습니다.

## 관련 파일

- `/app/api/kakao/notify/route.ts`: 카카오 알림 API 엔드포인트
- `/components/chat/ChatModal.tsx`: 채팅 모달에서 알림 발송 로직
- `/components/ChatInterface.tsx`: 채팅 인터페이스에서 알림 발송 로직

## 문제 해결

알림 발송에 문제가 발생할 경우:

1. 브라우저 콘솔에서 오류 메시지를 확인합니다.
2. Vercel 로그에서 서버 측 오류를 확인합니다.
3. Solapi 대시보드에서 메시지 발송 이력을 확인합니다.
4. 환경 변수가 올바르게 설정되었는지 확인합니다.
5. 템플릿 코드와 실제 발송 메시지 형식이 일치하는지 확인합니다.

## 추가 개발 과제

- [ ] 알림 발송 성공/실패 로그 DB 저장
- [ ] 사용자별 알림 설정 기능 (알림 켜기/끄기)
- [ ] 알림 발송 빈도 제한 (스팸 방지)
- [ ] 특정 시간대 알림 발송 제한
- [ ] 발송 실패 시 재시도 메커니즘 